name = 'MXNet'
version = '1.9.1'

homepage = 'https://mxnet.io/'
description = """Flexible and Efficient Library for Deep Learning"""

toolchain = {'name': 'foss', 'version': '2022a'}
toolchainopts = {'cstd': 'c++14', 'opt': True, 'pic': True, 'openmp': True, 'extra_cflags': '-lflexiblas'}

source_urls = [
    'https://github.com/apache/mxnet/archive',
    'https://github.com/oneapi-src/oneDNN/archive/',
]
sources = [
    'v%(version)s.tar.gz',  # MXNet
    'https://github.com/dmlc/ps-lite/archive/34fd45cae457d59850fdcb2066467778d0673f21.tar.gz',  # ps-lite
    'https://github.com/apache/tvm/archive/efdac9439506d1de5eec91ecc795982c78e41909.tar.gz',  # tvm
    'https://github.com/dmlc/dmlc-core/archive/5df8305fe699d3b503d10c60a231ab0223142407.tar.gz',  # dmlc-core
    'https://github.com/dmlc/dlpack/archive/3efc489b55385936531a06ff83425b719387ec63.tar.gz',  # dlpack
    'https://github.com/google/googletest/archive/eb9225ce361affe561592e0912320b9db84985d0.tar.gz',  # googletest
    'https://github.com/kpu/intgemm/archive/8f28282c3bd854922da638024d2659be52e892e9.tar.gz',  # intgemm
    'https://github.com/NVlabs/cub/archive/0158fa19f28619886232defd412433974af89611.tar.gz',  # cub
    'https://github.com/onnx/onnx-tensorrt/archive/2eb74d933f89e1590fdbfc64971a36e5f72df720.tar.gz',  # onnx-tensorrt
    # oneDNN:
    {
        'download_filename': '5818c40f07bdb6307f9bc64e929836fe036da644.tar.gz',
        'filename': 'mkldnn.tar.gz'
    }
]
patches = [
    'mxnet-fix_blas.patch',
]
checksums = [
    {'v1.9.1.tar.gz': '9927f986b2c2c8315f2ba675e050ce1f4e24e84c4692e5f0a96248876784a8a7'},
    {'34fd45cae457d59850fdcb2066467778d0673f21.tar.gz':
     'ec5d5baab8bbf0c3983ad5f18d7f963f15ae7cd4d154ec204b03c1dceccf209b'},
    {'efdac9439506d1de5eec91ecc795982c78e41909.tar.gz':
     '656c38d66baeab885b0212602148bb55ad3cf7d22f52ded8ece53f88e103a2f5'},
    {'5df8305fe699d3b503d10c60a231ab0223142407.tar.gz':
     'a8046f752f36005564d2924b4b6f73e1aea3cce7ff10f9e19d99ad6a22a045b2'},
    {'3efc489b55385936531a06ff83425b719387ec63.tar.gz':
     'b59586ce69bcf3efdbf3cf4803fadfeaae4948044e2b8d89cf912194cf28f233'},
    {'eb9225ce361affe561592e0912320b9db84985d0.tar.gz':
     'a4cb4b0c3ebb191b798594aca674ad47eee255dcb4c26885cf7f49777703484f'},
    {'8f28282c3bd854922da638024d2659be52e892e9.tar.gz':
     'bc8bd8015613a13747eb769876385ec53e8c1ea7ae3f8414521dc53b8fcdfc65'},
    {'0158fa19f28619886232defd412433974af89611.tar.gz':
     '43424c4c17a997d1d730c89ec14688671245de7941e02b388d7d3df6ea53777a'},
    {'2eb74d933f89e1590fdbfc64971a36e5f72df720.tar.gz':
     'df99819727445c247fb5c21c2fd825ded3269376867457ae84fa6d6f1c0ae331'},
    {'mkldnn.tar.gz': 'aeb8e65bb13d1a3171673ab749d41e8c3a6538371d922a7fa881afef277128ba'},
    {'mxnet-fix_blas.patch': '274d683f70ae60a65c981eac8a9b27e4a13c4f6f7386ac0f3eb0a462377860f0'},
]

# MXNet pulls in a bunch of submodules which don't have releases.
builddependencies = [
    ('CMake', '3.23.1'),
]

dependencies = [
    ('Python', '3.10.4'),
    ('graphviz-python', '0.20.1'),
    ('OpenCV', '4.6.0', '-contrib'),
    ('R', '4.2.1'),
]

moduleclass = 'math'
