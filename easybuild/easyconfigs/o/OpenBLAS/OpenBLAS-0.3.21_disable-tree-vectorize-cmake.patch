From 32566bfb44067e0c0459e94b53c9457613539eeb Mon Sep 17 00:00:00 2001
From: Martin Kroeker <martin@ruby.chemie.uni-freiburg.de>
Date: Thu, 13 Oct 2022 14:04:25 +0200
Subject: [PATCH] Disable the gfortran tree vectorizer for netlib LAPACK

---
 cmake/lapack.cmake | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/cmake/lapack.cmake b/cmake/lapack.cmake
index f8a27f5d4..3b221d420 100644
--- a/cmake/lapack.cmake
+++ b/cmake/lapack.cmake
@@ -999,6 +999,9 @@ endforeach ()
 
 if (NOT C_LAPACK)
   set_source_files_properties(${LA_SOURCES} PROPERTIES COMPILE_FLAGS "${LAPACK_FFLAGS}")
+  if (${F_COMPILER} STREQUAL "GFORTRAN")
+    set_source_files_properties(${LA_SOURCES} PROPERTIES COMPILE_FLAGS "${LAPACK_FFLAGS} -fno-tree-vectorize")
+  endif()
 else ()
   set_source_files_properties(${LA_SOURCES} PROPERTIES COMPILE_FLAGS "${LAPACK_CFLAGS}")
 endif ()
-- 
2.25.1

